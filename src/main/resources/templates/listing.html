<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è | WorkSwap</title>
    <link href="/css/public/pages/listing-page.css" rel="stylesheet">
    <link rel="icon" href="/favicon.ico">
</head>
<body>
<header>
    <div class="container">
        <nav class="navbar">
            <a class="navbar-brand" href="/catalog">WorkSwap</a>
            <button class="navbar-toggler">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-collapse">
                <div class="d-flex">
                    <!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div th:unless="${isAuthenticated}">
                        <a href="/login" class="btn btn-outline-primary">–í—Ö–æ–¥</a>
                        <a href="/register" class="btn btn-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>

                    <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div th:if="${isAuthenticated}" class="account-info">
                        <a th:href="@{/secure/account}" class="account-link">
                            <img th:src="${avatarUrl}"
                                 class="account-avatar"
                                 alt="–ê–≤–∞—Ç–∞—Ä"
                                 th:onerror="this.src='/images/avatar-placeholder.jpg'">
                            <span th:text="${userName}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="listing-container">
    <div class="listing-layout">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <main class="listing-main">
            <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
            <nav class="breadcrumbs">
                <a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
                <span> / </span>
                <a th:href="@{/catalog(category=${listing.category})}" th:text="${listing.category ?: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è'}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</a>
                <span> / </span>
                <span th:text="${listing.title}">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</span>
            </nav>

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
            <div class="listing-header">
                <h1 th:text="${listing.title}">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h1>
                <div class="listing-meta">
                    <span class="listing-date" th:text="${#temporals.format(listing.createdAt, 'dd.MM.yyyy')}">01.01.2023</span>
                    <span class="listing-views">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: <span th:text="${listing.views}">0</span></span>
                </div>
            </div>

            <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
            <div class="listing-gallery">
                <div class="main-image">
                    <img th:src="@{'/' + ${listing.imagePath}}"
                         th:onerror="this.src='/images/default-listing.png'"
                         alt="–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                </div>
                <div class="thumbnails" th:if="${listing.images != null and !listing.images.isEmpty()}">
                    <div class="thumbnail" th:each="image : ${listing.images}">
                        <img th:src="@{'/' + ${image.path}}"
                             th:onerror="this.src='/images/default-listing.png'"
                             alt="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ -->
            <div class="listing-content">
                <div class="listing-details">
                    <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
                    <p class="listing-description"
                       th:text="${listing.description ?: '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}">
                        –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
                    </p>

                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">–¶–µ–Ω–∞:</span>
                            <span class="detail-value price"
                                  th:text="${listing.price} +
                                  (${listing.priceType == 'per_hour'} ? '‚Ç¨/—á–∞—Å' :
                                  (${listing.priceType == 'per_day'} ? '‚Ç¨/–¥–µ–Ω—å' : '‚Ç¨'))">
                                50‚Ç¨/—á–∞—Å
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–õ–æ–∫–∞—Ü–∏—è:</span>
                            <span class="detail-value" th:text="${listing.location ?: '–•–µ–ª—å—Å–∏–Ω–∫–∏'}">–•–µ–ª—å—Å–∏–Ω–∫–∏</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                            <span class="detail-value" th:text="${listing.category ?: '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}">–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:</span>
                            <span class="detail-value"
                                  th:text="${listing.availableNow ? '–°–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–µ–Ω' : '–ü–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏'}">
                                  –°–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–µ–Ω
                            </span>
                        </div>
                    </div>

                    <div class="listing-features" th:if="${listing.features != null and !listing.features.isEmpty()}">
                        <h3>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
                        <ul class="features-list">
                            <li th:each="feature : ${listing.features}"
                                th:text="${feature ?: '–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å'}">
                                –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ -->
                <aside class="listing-sidebar">
                    <div class="seller-card" th:if="${listing.author != null}">
                        <div class="seller-avatar">
                            <img th:src="@{${authorAvatarPath}}"
                                 th:onerror="this.src='/images/default-avatar.png'"
                                 alt="–ê–≤–∞—Ç–∞—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞">
                        </div>
                        <div class="seller-info">
                            <h4 th:text="${listing.author.name ?: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä'}">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</h4>
                            <div class="seller-rating">
                                <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                                <span class="rating-value" th:text="${listing.author.rating != null ? listing.author.rating : '0'}">0</span>
                            </div>
                            <div class="seller-stats">
                                <span th:text="${listing.author.completedJobs != null ? listing.author.completedJobs : '0'}">0</span>

                            </div>
                        </div>
                        <div class="seller-actions">
                            <div th:if="${isAuthenticated}">
                                <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü -->
                                <div th:unless="${isOwner}">
                                    <form action="/secure/messenger/chat" method="get">
                                        <input type="hidden" name="sellerId" th:value="${listing.author.id}">
                                        <input type="hidden" name="listingId" th:value="${listing.id}">
                                        <button type="submit" class="btn btn-primary">–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                                    </form>
                                    <a href="#" class="btn btn-outline-primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                                </div>

                                <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ -->
                                <a th:href="@{'/secure/listing/edit/' + ${listing.id}}"
                                   class="btn btn-primary"
                                   th:if="${isOwner}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            </div>
                            <div th:unless="${isAuthenticated}">
                                <a href="/login" class="btn btn-primary">–í–æ–π—Ç–∏, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å</a>
                            </div>
                        </div>
                    </div>

                    <div class="contact-card" th:if="${listing.author != null}">
                        <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <div class="contact-methods">
                            <div class="contact-item">
                                <span class="contact-icon">üì±</span>
                                <span th:text="${listing.author.phoneVisible ? (listing.author.phone != null ? listing.author.phone : '–ù–µ —É–∫–∞–∑–∞–Ω') : '–°–∫—Ä—ã—Ç–æ'}">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-icon">‚úâÔ∏è</span>
                                <span class="contact-value"
                                      th:text="${listing.author.emailVisible ? (listing.author.email != null ? listing.author.email : '–ù–µ —É–∫–∞–∑–∞–Ω') : '–°–∫—Ä—ã—Ç–æ'}">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                            </div>
                        </div>
                    </div>

                </aside>
            </div>

            <!-- –û—Ç–∑—ã–≤—ã -->
            <section class="reviews-section" th:if="${listing.reviews != null and !listing.reviews.isEmpty()}">
                <h2>–û—Ç–∑—ã–≤—ã</h2>
                <div class="reviews-list">
                    <article th:each="review : ${listing.reviews}" class="review-card">
                        <div class="review-header">
                            <div class="reviewer-avatar">
                                <img th:src="${review.author.avatarUrl}"
                                     th:onerror="this.src='/images/default-avatar.png'"
                                     alt="–ê–≤–∞—Ç–∞—Ä –∞–≤—Ç–æ—Ä–∞ –æ—Ç–∑—ã–≤–∞">
                            </div>
                            <div class="reviewer-info">
                                <h4 th:text="${review.author.name ?: '–ê–Ω–æ–Ω–∏–º'}">–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤</h4>
                                <div class="review-meta">
                                    <span class="review-rating"
                                          th:text="${review.rating ?: '0'} + ' ‚òÖ'">
                                          5 ‚òÖ
                                    </span>
                                    <span class="review-date"
                                          th:text="${#temporals.format(review.createdAt, 'dd.MM.yyyy')}">
                                          15.03.2023
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="review-content">
                            <p th:text="${review.text ?: '–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ—Ç–∑—ã–≤–∞'}">
                                –û—Ç–ª–∏—á–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–∞–±–æ—Ç—É. –†–µ–∫–æ–º–µ–Ω–¥—É—é!
                            </p>
                        </div>
                    </article>
                </div>
            </section>

            <!-- –ü–æ—Ö–æ–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
            <section class="similar-listings" th:if="${similarListings != null and !similarListings.isEmpty()}">
                <h2>–ü–æ—Ö–æ–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
                <div class="listings-grid">
                    <article th:each="similarListing : ${similarListings}" class="listing-card">
                        <a th:href="@{/listing/{id}(id=${similarListing.id})}">
                            <img th:src="@{'/' + ${similarListing.imagePath}}"
                                 th:onerror="this.src='/images/default-listing.png'"
                                 class="listing-img"
                                 alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è">
                        </a>

                        <div class="card-body">
                            <h3 class="card-title">
                                <a th:href="@{/listing/{id}(id=${similarListing.id})}"
                                   th:text="${similarListing.title}">
                                    –ù–∞–∑–≤–∞–Ω–∏–µ
                                </a>
                            </h3>
                            <p class="card-text"
                               th:text="${#strings.length(similarListing.description) > 100} ?
                                      ${#strings.substring(similarListing.description, 0, 100)} + '...' :
                                      ${similarListing.description}">
                                –û–ø–∏—Å–∞–Ω–∏–µ
                            </p>
                            <div class="card-footer">
                                <div>
                                    <span class="price"
                                          th:text="${similarListing.price} +
                                          (${similarListing.priceType == 'per_hour'} ? '‚Ç¨/—á–∞—Å' :
                                          (${similarListing.priceType == 'per_day'} ? '‚Ç¨/–¥–µ–Ω—å' : '‚Ç¨'))">
                                          –¶–µ–Ω–∞
                                    </span>
                                    <div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                                </div>
                                <span class="location"
                                      th:text="${similarListing.location ?: '–•–µ–ª—å—Å–∏–Ω–∫–∏'}">
                                      –õ–æ–∫–∞—Ü–∏—è
                                </span>
                            </div>
                        </div>
                    </article>
                </div>
            </section>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    document.querySelector('.navbar-toggler').addEventListener('click', function() {
        document.querySelector('.navbar-collapse').classList.toggle('show');
    });
</script>
</body>
</html>