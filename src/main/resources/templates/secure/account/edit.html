<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактирование профиля | WorkSwap</title>
    <link href="/css/public/pages/account/edit-page.css" rel="stylesheet">
    <link rel="icon" href="/favicon.ico">
</head>
<body>
<header>
    <nav class="container">
        <nav class="navbar">
            <a class="navbar-brand" href="/catalog">WorkSwap</a>
            <button class="navbar-toggler">
                <span class="navbar-toggler-icon"></span>
            </button>
            <nav class="navbar-collapse">
                <nav class="navbar-top">
                    <a class="navbar-brand" href="/catalog">WorkSwap</a>
                    <button id="navbar-toggler" class="navbar-toggler">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </nav>
                <div class="account-manager">
                    <div class="profile-card">
                        <div class="profile-avatar">
                            <img th:src="@{${avatarPath}}" alt="Аватар">
                        </div>
                        <h4 class="profile-name" th:text="${userName}">Иван Иванов</h4>
                        <p class="profile-rating">★★★★☆ (4.2)</p>
                        <a href="/secure/account/edit" class="btn btn-outline-primary btn-sm">Редактировать профиль</a>
                    </div>

                    <nav class="account-menu">
                        <a href="/secure/account" class="account-menu-item">Мои объявления</a>
                        <a href="#" class="account-menu-item">Избранное</a>
                        <a href="/secure/messenger" class="account-menu-item">Сообщения</a>
                        <a href="/secure/account/edit" class="account-menu-item active">Настройки</a>
                        <a href="#" class="account-menu-item">Платежи</a>
                        <a href="#" class="account-menu-item">Безопасность</a>
                    </nav>
                </div>
                <div class="nav-buttons">
                    <a href="/logout" class="logout-btn">Выйти</a>
                </div>
            </nav>
        </nav>
    </nav>
</header>

<!-- Основной контент -->
<div class="account-container">
    <div class="account-layout">
        <!-- Сайдбар меню -->
        <aside class="account-sidebar">
            <div class="profile-card">
                <div class="profile-avatar">
                    <img th:src="@{${avatarPath}}" alt="Аватар">
                </div>
                <h4 class="profile-name" th:text="${user.name}">Иван Иванов</h4>
                <p class="profile-rating">★★★★☆ (4.2)</p>
                <a href="/secure/account" class="btn btn-outline-primary btn-sm">Назад в профиль</a>
            </div>

            <nav class="account-menu">
                <a href="/secure/account" class="account-menu-item">Мои объявления</a>
                <a href="#" class="account-menu-item">Избранное</a>
                <a href="#" class="account-menu-item">Сообщения</a>
                <a href="/secure/account/edit" class="account-menu-item active">Настройки</a>
                <a href="#" class="account-menu-item">Платежи</a>
                <a href="#" class="account-menu-item">Безопасность</a>
            </nav>
        </aside>

        <!-- Основное содержимое -->
        <main class="account-main">
            <div class="account-header">
                <h2>Редактирование профиля</h2>
            </div>

            <form th:action="@{/secure/account/update}" method="post" enctype="multipart/form-data" class="edit-form">
                <!-- Основная информация -->
                <div class="form-section">
                    <h3>Основная информация</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Имя</label>
                            <input type="text" id="name" name="name" th:value="${user.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email" th:value="${user.email}" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Телефон</label>
                            <input type="tel" id="phone" name="phone" th:value="${user.phone}">
                        </div>
                    </div>
                </div>

                <!-- Аватар -->
                <!-- Аватар -->
                <div class="form-section">
                    <h3>Аватар</h3>
                    <div class="avatar-upload">
                        <!-- Три варианта аватара в кружочках -->
                        <div class="avatar-options">
                            <!-- Вариант 1: Загруженная аватарка -->
                            <div class="avatar-option" data-type="uploaded">
                                <div class="avatar-preview">
                                    <img th:src="@{${avatarUrlPath}}" alt="Аватар">
                                    <img th:unless="${user.avatarUrl}" src="/images/upload-foto.png">
                                </div>
                                <span>Моя</span>
                            </div>

                            <!-- Вариант 2: Google аватар -->
                            <div class="avatar-option" data-type="google">
                                <div class="avatar-preview">
                                    <img th:if="${user.picture}" th:src="${user.picture}"
                                         onerror="this.src='/images/avatar-placeholder.png'">
                                    <img th:unless="${user.picture}" src="/images/avatar-placeholder.png">
                                </div>
                                <span>Google</span>
                            </div>

                            <!-- Вариант 3: Стандартная аватарка -->
                            <div class="avatar-option" data-type="default">
                                <div class="avatar-preview">
                                    <img src="/images/avatar-placeholder.png">
                                </div>
                                <span>Стандарт</span>
                            </div>
                        </div>

                        <!-- Скрытое поле для хранения выбора -->
                        <input type="hidden" name="avatarType" th:value="${user.avatarType ?: 'uploaded'}">

                        <!-- Блок загрузки (виден только при выборе "Моя") -->
                        <div class="upload-controls">
                            <input type="file" id="avatar" name="avatar" accept="image/*">
                            <label for="avatar" class="btn btn-outline-primary">Загрузить новую</label>
                            <span class="file-name">Файл не выбран</span>
                        </div>
                    </div>
                </div>

                <!-- О себе -->
                <div class="form-section">
                    <h3>О себе</h3>
                    <div class="form-group">
                        <label for="bio">Краткая информация</label>
                        <textarea id="bio" name="bio" rows="4" th:text="${user.bio}"></textarea>
                    </div>
                </div>

                <!-- Кнопки -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                    <a href="/secure/account" class="btn btn-outline-primary">Отмена</a>
                </div>
            </form>
        </main>
    </div>
</div>

<script>
    // Мобильное меню
    document.querySelector('.navbar-toggler').addEventListener('click', function() {
        document.querySelector('.navbar-collapse').classList.toggle('show');
    });
    document.getElementById('navbar-toggler').addEventListener('click', function() {
        document.querySelector('.navbar-collapse').classList.toggle('show');
    });

    // Отображение имени выбранного файла
    document.getElementById('avatar').addEventListener('change', function(e) {
        const fileName = e.target.files[0] ? e.target.files[0].name : 'Файл не выбран';
        document.querySelector('.file-name').textContent = fileName;
    });
</script>
<script src="/js/account/edit.js"></script>
</body>
</html>