<!-- карточка объявления для показа на публичных страницах (с рейтингом, локацией) -->
<article class="listing-card" th:fragment="listingCard(listing)">
    <img th:src="@{${listing.imagePath ?: '/images/default-listing.png'}}"
            class="listing-img" th:onerror="this.src='/images/default-listing.png'"
            alt="Изображение объявления">

    <div class="card-body">
        <h3 class="card-title" th:text="${listing.localizedTitle}">Название</h3>
        <p class="card-text" th:text="${#strings.length(listing.localizedDescription) > 100} ? ${#strings.substring(listing.localizedDescription, 0, 100)} + '...' : ${listing.localizedDescription}">Описание</p>
        <div class="card-footer">
            <div>
                <!-- компонент для отображение цены (с типом) -->
                <span th:replace="fragments/small-components :: priceTypes"></span>
                <div class="rating">
                    <th:block th:each="i : ${#numbers.sequence(1,5)}">
                        <i class="fa"
                            th:classappend="${listing.averageRating >= i} ? 'fa-star' :
                                    (${listing.averageRating >= i - 0.5} ? 'fa-star-half-o' : 'fa-star-o')"></i>
                    </th:block>
                </div>
            </div>
            <span class="listing-location" th:text="${listing.location ?: 'Finland'}">Локация</span>
        </div>
    </div>
</article>


<!-- карточка объявления для показа на страницах личного кабинета (с просмотрами и кнопками) -->
<article th:each="listing : ${listings}" class="listing-card" th:fragment="listingCardAccount(listing, activePage)">
    <div th:class="${listing.active} ? 'listing-status active' : 'listing-status inactive'"
            th:text="${listing.active} ? 'Активно' : 'Не активно'"></div>

    <img th:src="@{'/' + ${listing.imagePath}}"
            th:onerror="this.src='/images/default-listing.png'"
            class="listing-img"
            alt="Изображение объявления">

    <div class="card-body">
        <h3 class="card-title" th:text="${listing.localizedTitle}">Название</h3>
        <p class="card-text" th:text="${#strings.length(listing.localizedDescription) > 100} ? ${#strings.substring(listing.localizedDescription, 0, 100)} + '...' : ${listing.localizedDescription}">Описание</p>
        <div class="card-footer">
            <div>
                <!-- компонент для отображение цены (с типом) -->
                <span th:replace="fragments/small-components :: priceTypes"></span>
                <div class="listing-views">
                    <span th:text="#{listings.views}">0</span>
                    <span th:text="${listing.views}">0</span>
                </div>
            </div>
            <!-- кнопки только в "моих объявлениях" -->
            <div class="listing-actions" th:if="${activePage == 'account'}">
                <a th:href="@{/secure/listing/edit/{id}(id=${listing.id})}"
                    class="btn btn-sm btn-outline-primary" th:text="#{listing.edit}"></a>
                <form th:action="@{/secure/listing/delete/{id}(id=${listing.id})}"
                        method="post"
                        style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn btn-sm btn-outline-danger" th:text="#{my.listings.button.delete}"></button>
                </form>
            </div>
            <!-- кнопки только в "избранных" -->
            <div class="listing-actions" th:if="${activePage == 'favorites'}">
                <form th:action="@{/listing/{id}/favorite(id=${listing.id})}" method="post" style="display: inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn btn-sm btn-outline-danger" th:text="#{listing.favorite.remove}">Убрать из избранных</button>
                </form>
            </div>
        </div>
    </div>
</article>

<article th:each="similarListing : ${similarListings}" 
        class="listing-card" th:if="${similarListing.localizedTitle != null and similarListing.localizedDescription != null}" 
        th:fragment="similarListingCard(similarListing)">
    <a th:href="@{/listing/{id}(id=${similarListing.id})}">
        <img th:src="@{${similarListing.imagePath ?: '/images/default-listing.png'}}"
                class="listing-img"
                alt="Изображение объявления"></a>
    <div class="card-body">
        <h3 class="card-title">
            <a th:href="@{/listing/{id}(id=${similarListing.id})}"
                th:text="${similarListing.localizedTitle}">
                Название
            </a>
        </h3>
        <p class="card-text"
            th:text="${#strings.length(similarListing.localizedDescription) > 100} ?
        ${#strings.substring(similarListing.localizedDescription, 0, 100)} + '...' :
        ${similarListing.localizedDescription}">
            Описание
        </p>
        <div class="card-footer">
            <div>
                <span class="price" th:switch="${similarListing.priceType}">
                    <span th:case="'negotiable'" th:text="#{price.negotiable}">Договорная</span>
                    <span th:case="'per_hour'" th:text="${similarListing.price} + ' ' + #{price.per-hour}">Цена</span>
                    <span th:case="'per_day'" th:text="${similarListing.price} + ' ' + #{price.per-day}">Цена</span>
                    <span th:case="'fixed'" th:text="${similarListing.price} + ' ' + #{price.fixed}">Цена</span>
                    <span th:case="*">Цена не указана</span>
                </span>
                <div class="listing-rating">
                    <th:block th:each="i : ${#numbers.sequence(1,5)}">
                        <i class="fa"
                            th:classappend="${similarListing.averageRating >= i} ? 'fa-star' :
                                (${similarListing.averageRating >= i - 0.5} ? 'fa-star-half-o' : 'fa-star-o')"></i>
                    </th:block>
                </div>
            </div>
            <span class="location" th:text="${similarListing.location ?: 'Хельсинки'}">Локация</span>
        </div>
    </div>
</article>